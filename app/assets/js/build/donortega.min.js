"use strict";console.info("Don Ortega --- BigCommerce");var app=angular.module("bcDonOrtega",["ngAnimate","ngTouch","ui.bootstrap","ui.router"]);app.config(["$stateProvider",function(a){var b=[{name:"store",url:"",templateUrl:"views/category.html"},{name:"category",url:"",templateUrl:"views/category.html"},{name:"product",url:"/product/{productId}",templateUrl:"views/product.html",resolve:{product:function(a,b){return a.getList().then(function(a){return a[b.productId]})}},controller:function(a,b){a.product=b}},{name:"cart",url:"/cart",templateUrl:"views/cart.html"}];b.forEach(function(b){a.state(b)})}]),app.controller("StoreCtrl",["$rootScope","$scope","$timeout","products",function(a,b,c,d){var e=this;e.cartCount=0,e.qtyToAdd=1,localStorage.getItem("bigcommerce-cart")?localStorage.getItem("bigcommerce-cart").timestamp+36e5<(new Date).getTime()?(e.cart=[],localStorage.removeItem("bigcommerce-cart")):e.cart=JSON.parse(localStorage.getItem("bigcommerce-cart")).cart:e.cart=[],d.getList().then(function(a){e.productList=a}),e.getProductIndex=function(a){return e.productList.findIndex(function(b){return angular.equals(b,a)})},e.qtyDecrease=function(){e.qtyToAdd>1&&e.qtyToAdd--},e.changeCart=function(a,b,d,f,g){var h=e.cart.findIndex(function(a){return angular.equals(a.product,b)});"add"===a?(h===-1?e.cart.push({product:b,qty:d}):e.cart[h].qty=e.cart[h].qty+d,f&&c(function(){angular.element(document.getElementById("MyCart")).triggerHandler("click")})):"remove"===a&&(e.cart.splice(h,1),g.stopPropagation()),localStorage.setItem("bigcommerce-cart",JSON.stringify({cart:e.cart,timestamp:(new Date).getTime()}))},e.calculateTotal=function(){var a=0;return e.cart.forEach(function(b){a+=b.product.price*b.qty}),a},a.$on("$stateChangeSuccess",function(a,b,c,d,f){e.qtyToAdd=1})}]),app.service("products",["$http","$q",function(a,b){var c={};return c.getList=function(){return b(function(b,c){sessionStorage.getItem("bigcommerce-productList")?b(JSON.parse(sessionStorage.getItem("bigcommerce-productList"))):a.get("/assets/json/products.json").then(function(a){sessionStorage.setItem("bigcommerce-productList",JSON.stringify(a.data)),b(JSON.parse(sessionStorage.getItem("bigcommerce-productList")))},function(a){console.error("Failed to retrieve JSON:",a),c(a)})})},c}]);