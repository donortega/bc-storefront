"use strict";console.info("Don Ortega --- Don Ortega");var app=angular.module("bcDonOrtega",["ngAnimate","ngTouch","ui.bootstrap","ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){var c=[{name:"store",url:"/",templateUrl:"views/category.html"},{name:"category",url:"/",templateUrl:"views/category.html"},{name:"product",url:"/product/{productId}",templateUrl:"views/product.html",resolve:{product:function(a,b){return a.getList().then(function(a){return a[b.productId]})}},controller:function(a,b){a.product=b}},{name:"cart",url:"/cart",templateUrl:"views/cart.html"}];c.forEach(function(b){a.state(b)}),b.otherwise("/")}]),app.controller("StoreCtrl",["$rootScope","$scope","$timeout","$window","products",function(a,b,c,d,e){var f=this;f.cartCount=0,f.qtyToAdd=1,f.init=function(a){e.getList().then(function(a){f.productList=a}),!localStorage.getItem("bc-cart")||a?f.cart=[]:JSON.parse(localStorage.getItem("bc-cart")).timestamp+36e5<(new Date).getTime()?(f.cart=[],console.log("Cart timestamp is too old. Automatically purging Cart data."),localStorage.removeItem("bc-cart")):f.cart=JSON.parse(localStorage.getItem("bc-cart")).cart},f.getProductIndex=function(a){return f.productList.findIndex(function(b){return angular.equals(b,a)})},f.qtyDecrease=function(){f.qtyToAdd>1&&f.qtyToAdd--},f.changeCart=function(a,b,d,e,g){var h=f.cart.findIndex(function(a){return angular.equals(a.product,b)});"add"===a?(h===-1?f.cart.push({product:b,qty:d}):f.cart[h].qty=f.cart[h].qty+d,e&&c(function(){angular.element(document.getElementById("MyCart")).triggerHandler("click")})):"remove"===a?(f.cart.splice(h,1),g.stopPropagation()):"plus1"===a?f.cart[h].qty=f.cart[h].qty+1:"minus1"===a&&f.cart[h].qty>1&&(f.cart[h].qty=f.cart[h].qty-1),f.cart.length?localStorage.setItem("bc-cart",JSON.stringify({cart:f.cart,timestamp:(new Date).getTime()})):localStorage.removeItem("bc-cart")},f.calculateTotal=function(){var a=0;return f.cart.forEach(function(b){a+=b.product.price*b.qty}),a},a.$on("$stateChangeSuccess",function(a,b,c,e,g){f.qtyToAdd=1,d.scrollTo(0,0)})}]),app.service("products",["$http","$q",function(a,b){var c={};return c.getList=function(){var c=b.defer();return sessionStorage.getItem("bc-productList")?c.resolve(JSON.parse(sessionStorage.getItem("bc-productList"))):a.get("/assets/json/products.json").then(function(a){sessionStorage.setItem("bc-productList",JSON.stringify(a.data)),c.resolve(JSON.parse(sessionStorage.getItem("bc-productList")))},function(a){console.error("Failed to retrieve JSON:",a),c.reject(a)}),c.promise},c}]);